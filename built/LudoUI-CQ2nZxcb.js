import{j as e,f as t,c as l}from"./index-C3nRgRA3.js";import{h as r,D as s,M as n,l as a}from"./react-vendor-NLlMW-6j.js";import"./socket-DRbsQkF5.js";import"./zustand-C-abe4TX.js";import"./chess-DTd62Tay.js";const o={red:{bg:"bg-red-500",light:"bg-red-200",ring:"ring-red-400",fill:"#ef4444",text:"text-red-500"},blue:{bg:"bg-blue-500",light:"bg-blue-200",ring:"ring-blue-400",fill:"#3b82f6",text:"text-blue-500"},green:{bg:"bg-green-500",light:"bg-green-200",ring:"ring-green-400",fill:"#22c55e",text:"text-green-500"},yellow:{bg:"bg-yellow-400",light:"bg-yellow-200",ring:"ring-yellow-400",fill:"#eab308",text:"text-yellow-500"}};function i({game:i,currentUserId:x}){const[d,c]=r.useState(i.getState()),[y,h]=r.useState(!1),[u,g]=r.useState(1),[m,p]=r.useState(!1),f=r.useRef(null),b=r.useRef(null);r.useEffect(()=>(i.onUpdate(e=>{if(null!==e.diceValue&&e.diceValue!==f.current&&!y){const t=e.diceValue;h(!0),p(!1),b.current&&clearInterval(b.current);let l=0;b.current=setInterval(()=>{g(Math.floor(6*Math.random())+1),l++,l>10&&(b.current&&(clearInterval(b.current),b.current=null),g(t),h(!1),p(!0),setTimeout(()=>p(!1),2e3))},80),f.current=t}else null===e.diceValue&&(f.current=null);c(e)}),c(i.getState()),i.requestSync(),()=>{b.current&&clearInterval(b.current)}),[i]);const w=i.getMyPlayerIndex(),j=d.players[d.currentPlayerIndex],v=j?.id===x,N=i.isHostUser,k=v&&(!d.hasRolled||d.canRollAgain)&&!y&&!m,$=null!==d.diceValue&&d.players[d.currentPlayerIndex]?.tokens.some(e=>"home"===e.position.type?6===d.diceValue:"finished"!==e.position.type),P=()=>{k&&(f.current=null,i.requestRollDice())},R=e=>{const t=[{x:.5,y:6.5},{x:1.5,y:5.5},{x:2.5,y:5.5},{x:3.5,y:5.5},{x:4.5,y:5.5},{x:5.5,y:5.5},{x:5.5,y:4.5},{x:5.5,y:3.5},{x:5.5,y:2.5},{x:5.5,y:1.5},{x:5.5,y:.5},{x:6.5,y:.5},{x:7.5,y:.5},{x:7.5,y:1.5},{x:7.5,y:2.5},{x:7.5,y:3.5},{x:7.5,y:4.5},{x:7.5,y:5.5},{x:8.5,y:5.5},{x:9.5,y:5.5},{x:10.5,y:5.5},{x:11.5,y:5.5},{x:12.5,y:5.5},{x:12.5,y:6.5},{x:12.5,y:7.5},{x:11.5,y:7.5},{x:10.5,y:7.5},{x:9.5,y:7.5},{x:8.5,y:7.5},{x:7.5,y:7.5},{x:7.5,y:8.5},{x:7.5,y:9.5},{x:7.5,y:10.5},{x:7.5,y:11.5},{x:7.5,y:12.5},{x:6.5,y:12.5},{x:5.5,y:12.5},{x:5.5,y:11.5},{x:5.5,y:10.5},{x:5.5,y:9.5},{x:5.5,y:8.5},{x:5.5,y:7.5},{x:4.5,y:7.5},{x:3.5,y:7.5},{x:2.5,y:7.5},{x:1.5,y:7.5},{x:.5,y:7.5}];return t[e%t.length]||{x:6.5,y:6.5}},C=(t,l,r)=>{const s=((e,t,l)=>{if("home"===e.type){const e={red:{x:2.5,y:2.5},blue:{x:10.5,y:2.5},green:{x:10.5,y:10.5},yellow:{x:2.5,y:10.5}}[t],r=[{dx:-.6,dy:-.6},{dx:.6,dy:-.6},{dx:-.6,dy:.6},{dx:.6,dy:.6}][l];return{x:e.x+r.dx,y:e.y+r.dy}}if("board"===e.type)return R(e.position);if("finish"===e.type)return{red:[{x:1.5,y:6.5},{x:2.5,y:6.5},{x:3.5,y:6.5},{x:4.5,y:6.5},{x:5.5,y:6.5}],blue:[{x:6.5,y:1.5},{x:6.5,y:2.5},{x:6.5,y:3.5},{x:6.5,y:4.5},{x:6.5,y:5.5}],green:[{x:11.5,y:6.5},{x:10.5,y:6.5},{x:9.5,y:6.5},{x:8.5,y:6.5},{x:7.5,y:6.5}],yellow:[{x:6.5,y:11.5},{x:6.5,y:10.5},{x:6.5,y:9.5},{x:6.5,y:8.5},{x:6.5,y:7.5}]}[t][e.position]||{x:6.5,y:6.5};return"finished"===e.type?{x:6.5,y:6.5}:null})(t.position,l,t.id);if(!s)return null;const n=d.currentPlayerIndex===r,a=!y&&v&&r===w&&d.hasRolled&&i.isTokenMovable(t.id),x=o[l];return e.jsx("div",{className:`\n          absolute w-6 h-6 rounded-full border-2 border-white shadow-lg z-10\n          ${x.bg}\n          ${a?"cursor-pointer":""}\n          ${n&&!a?"opacity-90":""}\n        `,style:{left:s.x/13*100+"%",top:s.y/13*100+"%",transform:a?"translate(-50%, -50%) scale(1.25)":"translate(-50%, -50%)",transition:"left 0.5s ease-in-out, top 0.5s ease-in-out, transform 0.2s ease-in-out",boxShadow:a?`0 0 0 4px ${x.fill}, 0 0 20px ${x.fill}, 0 0 30px ${x.fill}80`:void 0,zIndex:a?20:10,animation:a?"pulse 1s ease-in-out infinite":void 0},onClick:()=>{return a&&(e=t.id,void(v&&d.hasRolled&&(y||i.isTokenMovable(e)&&i.requestMoveToken(e))));var e},children:e.jsx("span",{className:"flex items-center justify-center w-full h-full text-white text-xs font-bold drop-shadow-lg",children:t.id+1})},`${l}-${t.id}`)};return e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 w-full max-w-2xl mx-auto",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"\n@keyframes bounce-dice {\n  0%, 100% { transform: translateY(0) rotate(0deg); }\n  25% { transform: translateY(-20px) rotate(90deg); }\n  50% { transform: translateY(-10px) rotate(180deg); }\n  75% { transform: translateY(-15px) rotate(270deg); }\n}\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; box-shadow: 0 0 0 4px currentColor, 0 0 20px currentColor; }\n  50% { opacity: 0.8; box-shadow: 0 0 0 6px currentColor, 0 0 30px currentColor; }\n}\n\n@keyframes pulse-corner {\n  0%, 100% { opacity: 0.3; }\n  50% { opacity: 0.6; }\n}\n"}}),"playing"===d.gamePhase&&e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"text-lg text-gray-400",children:v?e.jsx("span",{className:"text-green-400 font-semibold",children:"Your turn!"}):e.jsxs("span",{children:["Waiting for"," ",e.jsx("span",{className:o[j?.color||"red"].text,children:j?.username}),"..."]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[(()=>{const t={"top-left":"top-1.5 left-1.5","top-right":"top-1.5 right-1.5","middle-left":"top-1/2 left-1.5 -translate-y-1/2","middle-right":"top-1/2 right-1.5 -translate-y-1/2",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2","bottom-left":"bottom-1.5 left-1.5","bottom-right":"bottom-1.5 right-1.5"};return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`\n            relative w-16 h-16 bg-white rounded-xl shadow-lg border-2 border-gray-300\n            ${k?"cursor-pointer hover:shadow-xl hover:scale-105 transition-all":""}\n          `,style:{animation:y?"bounce-dice 0.3s ease-in-out infinite":void 0},onClick:P,children:({1:["center"],2:["top-right","bottom-left"],3:["top-right","center","bottom-left"],4:["top-left","top-right","bottom-left","bottom-right"],5:["top-left","top-right","center","bottom-left","bottom-right"],6:["top-left","top-right","middle-left","middle-right","bottom-left","bottom-right"]}[u]||[]).map((l,r)=>e.jsx("div",{className:`absolute w-3 h-3 bg-gray-800 rounded-full ${t[l]}`},r))}),null!==d.diceValue&&!y&&e.jsxs("div",{className:"text-2xl font-bold text-white bg-slate-700 px-3 py-1 rounded-lg",children:["ðŸŽ² ",d.diceValue]})]})})(),k&&e.jsxs("button",{onClick:P,disabled:y,className:"flex items-center gap-2 px-5 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition-colors disabled:opacity-50 font-semibold",children:[e.jsx(s,{className:"w-5 h-5"}),y?"Rolling...":d.canRollAgain?"Roll Again! ðŸŽ‰":"Roll Dice"]})]}),d.hasRolled&&!d.canRollAgain&&v&&!y&&$&&e.jsx("span",{className:"text-yellow-400 animate-pulse",children:"ðŸ‘† Click a highlighted token to move"})]}),"ended"===d.gamePhase&&e.jsxs("div",{className:"text-center p-4 bg-slate-800 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Game Over!"}),e.jsx("p",{className:"text-gray-300",children:d.winner===x?"ðŸŽ‰ You won!":`${d.players.find(e=>e.id===d.winner)?.username} wins!`})]}),"waiting"===d.gamePhase&&e.jsx("div",{className:"grid grid-cols-2 gap-2 w-full max-w-md",children:d.players.map((t,l)=>{const r=o[t.color];return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${r.bg}`}),e.jsxs("span",{className:"text-sm text-white",children:[t.id?t.username:"(empty)",t.isBot&&" ðŸ¤–",t.id===x&&" (You)"]})]}),N&&(t.isBot?e.jsx("button",{onClick:()=>i.requestRemoveBot(l),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded",children:"âœ•"}):!t.id&&e.jsx("button",{onClick:()=>i.requestAddBot(l),className:"text-xs px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded",children:"+Bot"}))]},l)})}),e.jsxs("div",{className:"flex gap-3",children:["waiting"===d.gamePhase&&N&&i.canStartGame()&&e.jsxs("button",{onClick:()=>i.requestStartGame(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors",children:[e.jsx(n,{className:"w-4 h-4"})," Start Game"]}),"ended"===d.gamePhase&&e.jsxs("button",{onClick:()=>i.requestNewGame(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors",children:[e.jsx(a,{className:"w-4 h-4"})," Play Again"]})]}),e.jsxs("div",{className:"relative w-full max-w-[450px] aspect-square bg-slate-900 rounded-xl overflow-hidden shadow-2xl border-4 border-slate-700",children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 13 13",children:[d.players.map((t,l)=>{const r=d.currentPlayerIndex===l&&"playing"===d.gamePhase,s={red:{x:0,y:0},blue:{x:8,y:0},green:{x:8,y:8},yellow:{x:0,y:8}}[t.color];return e.jsxs("g",{children:[e.jsx("rect",{x:s.x,y:s.y,width:"5",height:"5",fill:o[t.color].fill,opacity:r?.5:.25,style:r?{animation:"pulse-corner 1s ease-in-out infinite"}:void 0}),e.jsx("rect",{x:s.x,y:s.y,width:"5",height:"5",fill:"none",stroke:r?o[t.color].fill:"transparent",strokeWidth:"0.15"})]},t.color)}),e.jsx("rect",{x:"5",y:"5",width:"3",height:"3",fill:"#374151",stroke:"#4b5563",strokeWidth:"0.05"}),e.jsx("polygon",{points:"6.5,5.5 7.5,6.5 6.5,7.5 5.5,6.5",fill:"#6b7280"}),[0,1,2,3,4].map(t=>e.jsx("rect",{x:5+.6*t,y:"0",width:"1",height:"5",fill:"none",stroke:"#374151",strokeWidth:"0.03"},`top-${t}`)),[0,1,2,3,4].map(t=>e.jsx("rect",{x:5+.6*t,y:"8",width:"1",height:"5",fill:"none",stroke:"#374151",strokeWidth:"0.03"},`bot-${t}`)),e.jsx("rect",{x:"5",y:"0",width:"3",height:"5",fill:"#4b5563"}),e.jsx("rect",{x:"5",y:"8",width:"3",height:"5",fill:"#4b5563"}),e.jsx("rect",{x:"0",y:"5",width:"5",height:"3",fill:"#4b5563"}),e.jsx("rect",{x:"8",y:"5",width:"5",height:"3",fill:"#4b5563"}),[0,1,2,3,4,5].map(t=>e.jsx("line",{x1:"5",y1:t,x2:"8",y2:t,stroke:"#374151",strokeWidth:"0.05"},`tv-${t}`)),[8,9,10,11,12,13].map(t=>e.jsx("line",{x1:"5",y1:t,x2:"8",y2:t,stroke:"#374151",strokeWidth:"0.05"},`bv-${t}`)),[0,1,2,3,4,5].map(t=>e.jsx("line",{x1:t,y1:"5",x2:t,y2:"8",stroke:"#374151",strokeWidth:"0.05"},`lh-${t}`)),[8,9,10,11,12,13].map(t=>e.jsx("line",{x1:t,y1:"5",x2:t,y2:"8",stroke:"#374151",strokeWidth:"0.05"},`rh-${t}`)),e.jsx("rect",{x:"1",y:"6",width:"4",height:"1",fill:"#ef4444",opacity:"0.4"}),e.jsx("rect",{x:"6",y:"1",width:"1",height:"4",fill:"#3b82f6",opacity:"0.4"}),e.jsx("rect",{x:"8",y:"6",width:"4",height:"1",fill:"#22c55e",opacity:"0.4"}),e.jsx("rect",{x:"6",y:"8",width:"1",height:"4",fill:"#eab308",opacity:"0.4"}),t.map((t,l)=>{const r=R(t);return e.jsx("circle",{cx:r.x,cy:r.y,r:"0.25",fill:"#8b5cf655"},l)})]}),d.players.map((t,l)=>{const r=(e=>{switch(e){case"red":return{x:"19.2%",y:"3%"};case"blue":return{x:"80.8%",y:"3%"};case"green":return{x:"80.8%",y:"97%"};case"yellow":return{x:"19.2%",y:"97%"}}})(t.color),s=d.currentPlayerIndex===l&&"playing"===d.gamePhase,n=o[t.color];return e.jsxs("div",{className:`\n                absolute px-2 py-0.5 rounded text-xs font-bold\n                ${s?`${n.bg} text-white`:"bg-black/50 "+n.text}\n                ${s?"animate-pulse":""}\n              `,style:{left:r.x,top:r.y,transform:`translate(-50%, ${"97%"===r.y?"-100%":"0"})`},children:[t.id?t.username:"(empty)",t.isBot&&" ðŸ¤–"]},`name-${t.color}`)}),d.players.map((e,t)=>e.id&&e.tokens.map(l=>C(l,e.color,t)))]}),"playing"===d.gamePhase&&N&&e.jsxs("button",{onClick:async()=>{await l.getState().confirm("Are you sure you want to reset the game? All progress will be lost.","New Game")&&i.requestNewGame()},className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg transition-colors",children:[e.jsx(a,{className:"w-4 h-4"})," New Game"]})]})}export{i as default};
