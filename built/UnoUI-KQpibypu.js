import{u as e,a as s,j as t,b as l}from"./index-BnUAJw6e.js";import{l as a,i as n,ag as r,a6 as i,X as d,A as c,a9 as o,a5 as m,af as x,a4 as h,Z as u,J as g}from"./react-vendor-DuHYuIQj.js";import"./socket-DRbsQkF5.js";import{C as p,b as f,a as b,T as j}from"./types-k4MwRBn0.js";import"./zustand-BR1a1S03.js";function N({game:h}){const u=h,[g,j]=a.useState(u.getState()),[N,P]=a.useState(null),[C,k]=a.useState(!1),[R,D]=a.useState(!1),[S,I]=a.useState(!1),{username:U}=e(),{ti:$,ts:T}=s(),[z,G]=a.useState(null),[q,B]=a.useState(!1),[W,E]=a.useState(0),O=a.useRef([null,null,null,null]),A=a.useRef([null,null,null,null]),H=a.useRef(null),L=a.useRef(null),J=a.useRef(null),M=a.useRef(null),Y=a.useRef(null),_=a.useRef(null),F=u.isHostUser,K=u.getMyPlayerIndex(),X=K>=0?g.players[K]:null,Z=g.currentTurnIndex===K,Q=u.canStartGame(),V=a.useRef(g.discardPile.length),ee=a.useRef(g.players.map(e=>e.hand.length));a.useEffect(()=>{u.onUpdate(e=>{if(e.discardPile.length>V.current&&"playing"===e.gamePhase){const s=e.discardPile[e.discardPile.length-1],t=(e.currentTurnIndex-e.turnDirection+4)%4;B(!0),G({card:s,fromPlayerIndex:t,direction:"toDiscard"}),setTimeout(()=>{B(!1),G(null)},350)}e.players.forEach((s,t)=>{const l=ee.current[t]||0,a=s.hand.length;if(a>l&&"playing"===e.gamePhase){const e=t===K,n=a-l,r=e?s.hand[s.hand.length-1]:void 0;e&&E(n),G({card:r,fromPlayerIndex:t,direction:"toHand",hidden:!e}),setTimeout(()=>{e&&E(0),G(null)},350)}}),V.current=e.discardPile.length,ee.current=e.players.map(e=>e.hand.length),j(e),P(null)})},[u,K]);const se=()=>{u.requestDrawCard()},te=a.useMemo(()=>{const e=[],s=K>=0?K:0;for(let t=0;t<4;t++){const l=(s+t)%4;e.push({slot:g.players[l],actualIndex:l})}return e},[g.players,K]),le=g.discardPile[g.discardPile.length-1],ae=(e,s=!1,l)=>{const a=te[e],n=K>=0;return t.jsx("div",{ref:s=>{l&&(l.current[e]=s)},children:t.jsx(v,{slot:a.slot,index:a.actualIndex,isCurrentTurn:g.currentTurnIndex===a.actualIndex,isHost:F,gamePhase:g.gamePhase,onAddBot:()=>u.requestAddBot(a.actualIndex),onJoinSlot:()=>u.requestJoinSlot(a.actualIndex,U),onRemove:()=>u.requestRemovePlayer(a.actualIndex),compact:s,isInGame:n})},a.actualIndex)},ne=(e,s,l)=>{const a=e?"medium":"large",r=e?"w-14 h-20":"w-20 h-28",i=e?"w-5 h-5":"w-8 h-8",d=e?"flex md:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]":"hidden md:flex flex-1 flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4";return t.jsxs("div",{className:d,children:["waiting"===g.gamePhase&&t.jsxs("div",{className:"flex flex-col items-center "+(e?"gap-2":"gap-4"),children:[t.jsx("span",{className:e?"text-slate-400 text-sm":"text-slate-400",children:"Waiting for players..."}),F&&Q&&t.jsxs("button",{onClick:()=>u.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 "+(e?"text-sm px-4 py-2":""),children:[t.jsx(m,{className:e?"w-4 h-4":"w-5 h-5"}),e?"Start":"Start Game"]}),F&&!Q&&t.jsx("span",{className:"text-sm text-slate-500",children:"Need at least 2 players to start"})]}),"playing"===g.gamePhase&&t.jsxs("div",{className:"flex flex-col items-center "+(e?"gap-2":"gap-4"),children:[t.jsxs("div",{className:"flex items-center "+(e?"gap-4":"gap-6"),children:[t.jsxs("button",{ref:l,onClick:se,disabled:!Z,className:`relative ${r} bg-gradient-to-br from-slate-700 to-slate-900 rounded-xl border-2 border-slate-600 flex items-center justify-center hover:border-slate-400 transition-all disabled:opacity-50`,children:[t.jsx(n,{className:`${i} text-slate-400`}),t.jsx("span",{className:"absolute bottom-1 text-xs text-slate-400",children:g.drawPile.length})]}),t.jsx("div",{ref:s,className:`relative ${r}`,children:t.jsxs("button",{onClick:()=>D(!0),className:"absolute inset-0 cursor-pointer hover:scale-105 transition-transform",title:"Click to view history",children:[g.discardPile.slice(-4).map((s,l,n)=>{const r=l===n.length-1;if(r&&q)return null;const i=(n.length-1-l)*(e?2:3),d=(l-Math.floor(n.length/2))*(e?4:5);return t.jsx("div",{className:"absolute inset-0",style:{transform:`translateX(${i}px) translateY(${-i}px) rotate(${d}deg)`,zIndex:l,opacity:r?1:.7},children:t.jsx(y,{card:s,size:a})},s.id)}),le&&t.jsx("div",{className:`absolute -bottom-2 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full border-2 border-white z-10 ${f[g.currentColor]}`}),t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-slate-600 rounded-full text-[10px] flex items-center justify-center z-20",children:g.discardPile.length})]})})]}),g.pendingDraw>0&&t.jsxs("div",{className:"text-lg font-bold text-red-400 animate-pulse",children:["+",g.pendingDraw," cards pending!"]}),t.jsx("div",{className:"text-sm "+(e?"hidden":"block"),children:Z?t.jsxs("span",{className:"text-primary-400 font-medium",children:["Your Turn",g.hasDrawn&&" - Play drawn card or pass"]}):t.jsxs("span",{className:"text-slate-400",children:[g.players[g.currentTurnIndex]?.username,"'s Turn"]})}),t.jsxs("div",{className:"text-xs text-slate-500 "+(e?"hidden":"block"),children:["Direction:"," ",1===g.turnDirection?"→ Clockwise":"← Counter-clockwise"]})]}),"ended"===g.gamePhase&&t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx(x,{className:(e?"w-8 h-8":"w-12 h-12")+" text-yellow-400"}),t.jsxs("span",{className:(e?"text-lg":"text-xl")+" font-bold text-yellow-400",children:[g.players.find(e=>e.id===g.winner)?.username," Won!"]})]})]})};return t.jsxs("div",{ref:Y,className:"relative flex flex-col h-full p-2 md:p-4 gap-2 md:gap-4 overflow-hidden",children:[S?t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 p-4",onClick:()=>I(!1),children:t.jsxs("div",{className:"bg-slate-800 rounded-xl max-w-2xl w-full max-h-[90%] flex flex-col shadow-2xl border border-slate-600",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(o,{className:"w-6 h-6 text-yellow-500"}),$({en:"Game Rules",vi:"Luật Chơi"})]}),t.jsx("button",{onClick:()=>I(!1),className:"p-1 hover:bg-slate-700 rounded transition-colors text-white",children:t.jsx(d,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar text-slate-300",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{children:$({en:"Uno is a shedding-type card game. The goal is to be the first player to get rid of all your cards.",vi:"Uno là trò chơi bài với mục tiêu là người đầu tiên đánh hết bài trên tay."})}),t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:$({en:"Gameplay",vi:"Luật chơi"})}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[t.jsx("li",{children:$({en:"Match the top card on the discard pile by color or number.",vi:"Đánh bài cùng màu hoặc cùng số với lá bài trên cùng."})}),t.jsxs("li",{children:[$({en:"Play Action cards to change the game:",vi:"Sử dụng các lá bài chức năng để thay đổi cục diện:"}),t.jsxs("ul",{className:"list-disc pl-5 mt-1 text-slate-400",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Skip"}),":"," ",$({en:"Next player loses turn",vi:"Người tiếp theo mất lượt"})]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Reverse"}),":"," ",$({en:"Reverses play direction",vi:"Đảo chiều vòng đánh"})]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Draw +2"}),":"," ",$({en:"Next player draws 2 cards and skips turn",vi:"Người sau phải bốc 2 lá và mất lượt"})]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Wild"}),":"," ",$({en:"Change current color",vi:"Đổi màu đang đánh"})]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Wild +4"}),":"," ",$({en:"Change color + next player draws 4",vi:"Đổi màu + người sau bốc 4 lá"})]})]})]}),t.jsx("li",{children:$({en:"If you can't play, you must draw a card.",vi:"Nếu không đánh được, bạn phải bốc 1 lá bài."})})]}),t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:$({en:"UNO!",vi:"UNO!"})}),t.jsx("ul",{className:"list-disc pl-5 space-y-1",children:t.jsx("li",{children:$({en:"When you have 1 card left, you MUST yell call 'UNO!'.",vi:"Khi còn 1 lá bài, bạn BẮT BUỘC phải hô 'UNO!'."})})}),t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:$({en:"Winning",vi:"Chiến thắng"})}),t.jsx("ul",{className:"list-disc pl-5 space-y-1",children:t.jsx("li",{children:$({en:"The first player to play their last card wins the round.",vi:"Người đầu tiên đánh hết bài sẽ thắng."})})})]})})]})}):null,t.jsxs("div",{className:"flex md:hidden justify-center gap-2",children:[ae(1,!0,A),ae(2,!0,A),ae(3,!0,A)]}),t.jsx("div",{className:"hidden md:flex justify-center",children:ae(2,!1,O)}),t.jsxs("div",{className:"hidden md:flex flex-1 items-center justify-between gap-4",children:[ae(1,!1,O),ne(!1,H,J),ae(3,!1,O)]}),ne(!0,L,M),t.jsxs("div",{className:"flex flex-col items-center gap-2 md:gap-4",children:[t.jsx("div",{className:"hidden md:block",children:ae(0,!1,O)}),t.jsx("div",{className:"flex md:hidden",children:ae(0,!0,A)}),X&&"playing"===g.gamePhase&&t.jsx("div",{className:"w-full overflow-x-auto overflow-y-visible pt-4 pb-1",children:t.jsx("div",{ref:_,className:"flex w-fit mx-auto px-4",children:X.hand.map((e,s)=>{const l=Z&&u.canPlayCardCheck(e);return s>=X.hand.length-W?null:t.jsx("button",{onClick:()=>(e=>{Z&&"playing"===g.gamePhase&&(g.pendingDraw>0||u.canPlayCardCheck(e)&&(e.type===b.WILD||e.type===b.WILD_DRAW_FOUR?(P(e),k(!0)):u.requestPlayCard(e)))})(e),disabled:!Z||!l,className:`transition-transform duration-150 ${s>0?"-ml-6 md:-ml-8":""} ${l?"-translate-y-2 hover:-translate-y-3 cursor-pointer":"cursor-not-allowed"}`,style:{zIndex:s},children:t.jsx(y,{card:e,size:"medium"})},e.id)})})}),"playing"===g.gamePhase&&Z&&t.jsxs("div",{className:"flex gap-2",children:[g.pendingDraw>0&&t.jsxs("button",{onClick:se,className:"px-4 py-1.5 md:px-6 md:py-2 bg-red-600 hover:bg-red-500 rounded-lg font-medium flex items-center gap-1 md:gap-2 text-sm",children:[t.jsx(n,{className:"w-4 h-4"}),"Draw ",g.pendingDraw]}),g.hasDrawn&&t.jsx("button",{onClick:se,className:"px-4 py-1.5 md:px-6 md:py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-1 md:gap-2 text-sm",children:"Pass"}),X&&X.hand.length<=2&&!X.calledUno&&t.jsxs("button",{onClick:()=>{u.requestCallUno()},className:"px-4 py-1.5 md:px-6 md:py-2 bg-yellow-600 hover:bg-yellow-500 rounded-lg font-bold flex items-center gap-1 md:gap-2 text-sm animate-pulse",children:[t.jsx(r,{className:"w-4 h-4"}),"UNO!"]})]}),"waiting"!==g.gamePhase&&t.jsx("div",{className:"flex gap-2",children:t.jsxs("button",{onClick:async()=>{if(F&&"playing"===g.gamePhase){await l.getState().confirm("This will reset the current game and start fresh.","Start New Game?")&&u.requestNewGame()}else u.requestNewGame()},className:"px-3 py-1.5 md:px-4 md:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs md:text-sm flex items-center gap-1 md:gap-2",children:[t.jsx(i,{className:"w-3 h-3 md:w-4 md:h-4"}),"New game"]})})]}),C&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 md:p-6 shadow-xl",children:[t.jsx("h3",{className:"text-base md:text-lg font-bold mb-4 text-center",children:"Choose Color"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:[p.RED,p.BLUE,p.GREEN,p.YELLOW].map(e=>t.jsx("button",{onClick:()=>(e=>{N&&(u.requestPlayCard(N,e),k(!1),P(null))})(e),className:`w-16 h-16 md:w-20 md:h-20 rounded-xl ${f[e]} hover:scale-110 transition-transform border-4 border-white/30`},e))}),t.jsx("button",{onClick:()=>{k(!1),P(null)},className:"mt-4 w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm",children:"Cancel"})]})}),F&&g.newGameRequest&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 md:p-6 max-w-sm w-full shadow-xl",children:[t.jsx("h3",{className:"text-base md:text-lg font-bold mb-3 md:mb-4",children:"New Game Request"}),t.jsxs("p",{className:"text-slate-300 mb-4 md:mb-6 text-sm md:text-base",children:[t.jsx("span",{className:"font-medium text-white",children:g.newGameRequest.fromName})," ","wants to start a new game."]}),t.jsxs("div",{className:"flex gap-2 md:gap-3",children:[t.jsxs("button",{onClick:()=>u.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[t.jsx(d,{className:"w-4 h-4"}),"Decline"]}),t.jsxs("button",{onClick:()=>u.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[t.jsx(c,{className:"w-4 h-4"}),"Accept"]})]})]})}),R&&t.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>D(!1),children:t.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 md:p-6 max-w-md w-full max-h-[80vh] shadow-xl",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("h3",{className:"text-base md:text-lg font-bold",children:["Discard Pile (",g.discardPile.length," cards)"]}),t.jsx("button",{onClick:()=>D(!1),className:"p-1 hover:bg-slate-700 rounded",children:t.jsx(d,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"overflow-y-auto max-h-[60vh] grid grid-cols-4 md:grid-cols-5 gap-2",children:[...g.discardPile].reverse().map((e,s)=>t.jsx("div",{className:"relative",children:t.jsx(y,{card:e,size:"small"})},`${e.id}-${s}`))})]})}),t.jsx("button",{onClick:()=>I(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:T({en:"Rules",vi:"Luật chơi"}),children:t.jsx(o,{size:24})}),z&&t.jsx(w,{card:z.card,hidden:z.hidden,fromPlayerIndex:z.fromPlayerIndex,myIndex:K,desktopSlotRefs:O,mobileSlotRefs:A,myHandRef:_,desktopDiscardPileRef:H,mobileDiscardPileRef:L,desktopDrawPileRef:J,mobileDrawPileRef:M,containerRef:Y,direction:z.direction})]})}function y({card:e,size:s="medium",hidden:l=!1}){const a={small:"w-10 h-14",medium:"w-14 h-20 md:w-16 md:h-24",large:"w-20 h-28"};if(l||!e)return t.jsx("div",{className:`\n        ${a[s]}\n        bg-slate-900\n        rounded-lg md:rounded-xl shadow-lg\n        border-2 border-slate-700\n        shrink-0\n        relative\n        overflow-hidden\n      `,children:t.jsx("div",{className:"absolute inset-1 rounded border-2 border-slate-600 flex items-center justify-center bg-gradient-to-br from-slate-800 to-black",children:t.jsx("span",{className:"text-slate-700/50 font-bold transform -rotate-45 select-none text-sm md:text-base",children:"UNO"})})});return t.jsx("div",{className:`\n        ${a[s]}\n        ${f[e.color]}\n        rounded-lg md:rounded-xl shadow-lg\n        border-2 border-white/30\n        font-bold text-white\n        ${{small:"text-lg",medium:"text-xl md:text-2xl",large:"text-3xl"}[s]}\n        shrink-0\n        relative\n      `,style:{textShadow:"1px 1px 2px rgba(0,0,0,0.5)"},children:t.jsx("span",{className:"absolute top-0.5 left-1.5",children:e.type===b.NUMBER?e.value?.toString()||"0":j[e.type]})})}function w({card:e,hidden:s=!1,fromPlayerIndex:l,myIndex:n,myHandRef:r,desktopSlotRefs:i,mobileSlotRefs:d,desktopDiscardPileRef:c,mobileDiscardPileRef:o,desktopDrawPileRef:m,mobileDrawPileRef:x,containerRef:h,direction:u="toDiscard"}){const[g,p]=a.useState(null),[f,b]=a.useState(!1);if(a.useEffect(()=>{const e=(l-(n>=0?n:0)+4)%4;let s;const t=e=>e&&null!==e.offsetParent;s=0===e&&t(r.current)?r.current:t(i.current?.[e])?i.current?.[e]:t(d.current?.[e])?d.current?.[e]:r.current||i.current?.[e]||d.current?.[e];const a=t(c.current)?c.current:o.current||c.current||o.current,g=t(m?.current)?m?.current:x?.current||m?.current||x?.current,f=h.current;if(!s||!a||!f)return;let j,N;if("toDiscard"===u)j=s,N=a;else{if(!g)return;j=g,N=s}const y=f.getBoundingClientRect(),w=j.getBoundingClientRect(),v=N.getBoundingClientRect(),P={x:w.left+w.width/2-y.left-40,y:w.top+w.height/2-y.top-56},C={x:v.left+v.width/2-y.left-40,y:v.top+v.height/2-y.top-56};p({startPos:P,endPos:C});const k=setTimeout(()=>{b(!0)},10);return()=>clearTimeout(k)},[l,n,i,d,r,c,o,m,x,h,u]),!g)return null;const{startPos:j,endPos:N}=g,w=f?N:j;return t.jsx("div",{className:"absolute pointer-events-none z-50",style:{left:w.x,top:w.y,transition:f?"all 300ms ease-out":"none",transform:f?"scale(1.1) rotate(5deg)":"scale(0.8)",opacity:f?1:.8},children:t.jsx(y,{card:e,size:"large",hidden:s})})}function v({slot:e,index:s,isCurrentTurn:l,isHost:a,gamePhase:n,onAddBot:r,onJoinSlot:i,onRemove:c,compact:o=!1,isInGame:m}){const x=null===e.id,p=a&&"waiting"===n,f=!a&&"waiting"===n&&!m;return t.jsx("div",{className:`\n        ${o?"p-2 min-w-[90px]":"p-2 md:p-3 min-w-[100px] md:min-w-[120px]"}\n        rounded-lg md:rounded-xl transition-all border-2\n        ${l&&"playing"===n?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${x?"border-dashed":""}\n      `,children:x?t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",s+1]}),t.jsxs("div",{className:"flex gap-1",children:[p&&t.jsx("button",{onClick:r,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:t.jsx(h,{className:"w-5 h-5"})}),f&&t.jsxs("button",{onClick:i,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[t.jsx(u,{className:"w-4 h-4"}),"Join"]})]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&t.jsx(h,{className:"w-5 h-5 text-blue-400"}),e.isHost&&t.jsx(g,{className:"w-5 h-5 text-yellow-400"}),t.jsx("span",{className:"text-xs font-medium",children:e.username}),p&&e.id&&!e.isHost&&t.jsx("button",{onClick:c,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:t.jsx(d,{className:"w-5 h-5 text-red-400"})})]}),("playing"===n||"ended"===n)&&t.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," cards"]}),e.calledUno&&e.hand.length<=1&&t.jsx("span",{className:"text-[10px] text-yellow-400 font-bold",children:"UNO!"})]})})}export{N as default};
