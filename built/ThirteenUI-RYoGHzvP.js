import{u as e,a as s,j as t,b as a}from"./index-BnUAJw6e.js";import{l,a5 as n,ae as i,a6 as r,X as d,A as c,a9 as m,af as o,a4 as x,Z as h,J as u}from"./react-vendor-DuHYuIQj.js";import"./socket-DRbsQkF5.js";import{S as p,a as g,b as f}from"./types-B7pdz5Vg.js";import"./zustand-BR1a1S03.js";function b({game:x}){const h=x,[u,p]=l.useState(h.getState()),[g,f]=l.useState([]),[b,y]=l.useState(!1),[w,k]=l.useState(!1),{username:C}=e(),{ti:P,ts:S}=s(),T=h.isHostUser,$=h.getMyPlayerIndex(),G=$>=0?u.players[$]:null,I=u.currentTurnIndex===$,R=h.canStartGame(),q=l.useMemo(()=>{if(0===g.length||!G)return null;const e=g.map(e=>G.hand[e]);return h.validateSelectedCards(e)},[g,G,h]);l.useEffect(()=>{h.onUpdate(e=>{p(e),f([])})},[h]);const A=l.useMemo(()=>{const e=[],s=$>=0?$:0;for(let t=0;t<4;t++){const a=(s+t)%4;e.push({slot:u.players[a],actualIndex:a})}return e},[u.players,$]),H=e=>{const s="desktop"===e,a=s?"min-h-[80px]":"min-h-[60px]",l=s?"text-sm":"text-xs",n=s?"mt-6":"mt-4";return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`relative ${a} flex items-center justify-center`,children:0===u.currentTrick.length?t.jsx("span",{className:"text-slate-500 "+(s?"":"text-sm"),children:"New Round"}):t.jsx("div",{className:"flex cursor-pointer items-center justify-center max-w-[200px]",onClick:()=>y(!b),children:u.currentTrick.map((e,a)=>{const l=e.cards.length>1,n=u.currentTrick.length,i=(b?-30:-90)*a+-(b?-30*(n-1):-90*(n-1))/2,r=a*(s?4:3);return t.jsx("div",{style:{transform:`translateX(${i}%) translateY(${r}px)`},className:`\n                      flex rounded-lg transition-all duration-300 ease-out\n                      ${l?"bg-slate-700/30 ring-1 ring-slate-600":""}\n                    `,children:e.cards.map((e,s)=>t.jsx(N,{index:s,card:e,delay:50*s},s))},a)})})}),"playing"===u.gamePhase&&t.jsx("div",{className:`${l} border-t ${n} pt-2`,children:I?t.jsx("span",{className:"text-primary-400 font-medium",children:"Your Turn"}):t.jsxs("span",{className:"text-slate-400",children:[u.players[u.currentTurnIndex]?.username,"'s Turn"]})})]})},D=e=>{const s="desktop"===e,a=s?"w-12 h-12":"w-8 h-8",l=s?"text-xl":"text-base",n=s?"gap-4":"gap-2";return t.jsxs("div",{className:`flex flex-col items-center ${n}`,children:[t.jsx(o,{className:`${a} text-yellow-400`}),t.jsxs("span",{className:`${l} font-bold text-yellow-400`,children:[u.players.find(e=>e.id===u.winner)?.username," Won!"]})]})},J=(e,s=!1)=>{const a=A[e],l=$>=0;return t.jsx(v,{slot:a.slot,index:a.actualIndex,isCurrentTurn:u.currentTurnIndex===a.actualIndex,isHost:T,gamePhase:u.gamePhase,onAddBot:()=>h.requestAddBot(a.actualIndex),onJoinSlot:()=>h.requestJoinSlot(a.actualIndex,C),onRemove:()=>h.requestRemovePlayer(a.actualIndex),compact:s,isInGame:l},a.actualIndex)};return t.jsxs("div",{className:"flex flex-col h-full p-2 md:p-4 gap-2 md:gap-4 overflow-hidden md:min-h-[500px] pb-10",children:[w?t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 p-4",onClick:()=>k(!1),children:t.jsxs("div",{className:"bg-slate-800 rounded-xl max-w-2xl w-full max-h-[90%] flex flex-col shadow-2xl border border-slate-600",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(m,{className:"w-6 h-6 text-yellow-500"}),P({en:"Game Rules",vi:"Luật Chơi"})]}),t.jsx("button",{onClick:()=>k(!1),className:"p-1 hover:bg-slate-700 rounded transition-colors text-white",children:t.jsx(d,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar text-slate-300",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{children:P({en:"Thirteen (Tien Len) is a popular climbing card game using a standard 52-card deck. The goal is to be the first to empty your hand.",vi:"Tiến Lên Miền Nam là trò chơi bài phổ biến sử dụng bộ bài 52 lá. Mục tiêu là người đầu tiên đánh hết bài."})}),t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:P({en:"Card Ranking",vi:"Thứ tự bài"})}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[t.jsx("li",{children:P({en:"Ranks (Low to High): 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A, 2.",vi:"Giá trị (Thấp đến Cao): 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, A, 2."})}),t.jsx("li",{children:P({en:"Suits (Low to High): Spades ♠ < Clubs ♣ < Diamonds ♦ < Hearts ♥.",vi:"Chất (Thấp đến Cao): Bích ♠ < Chuồn ♣ < Rô ♦ < Cơ ♥."})})]}),t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:P({en:"Combinations",vi:"Các bộ bài"})}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[t.jsxs("li",{children:[t.jsx("strong",{children:P({en:"Single",vi:"Rác"})}),":"," ",P({en:"A single card.",vi:"Một lá bài lẻ."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:P({en:"Pair",vi:"Đôi"})}),":"," ",P({en:"Two cards of the same rank.",vi:"2 lá cùng giá trị."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:P({en:"Triple",vi:"Sám cô"})}),":"," ",P({en:"Three cards of the same rank.",vi:"3 lá cùng giá trị."})]}),t.jsxs("li",{children:[t.jsx("strong",{children:P({en:"Straight",vi:"Sảnh"})}),":"," ",P({en:"3+ consecutive rank cards (e.g., 3-4-5). 2 cannot be in a straight.",vi:"3+ lá liên tiếp (VD: 3-4-5). 2 không được nằm trong sảnh."})]})]}),t.jsx("h3",{className:"text-lg font-bold text-yellow-400 mt-4",children:P({en:"Gameplay",vi:"Luật chơi"})}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[t.jsx("li",{children:P({en:"Play a combination that is higher (better rank/suit) than the previous one to beat it.",vi:"Đánh bộ bài cao hơn (về giá trị/chất) để chặn bài trước đó."})}),t.jsx("li",{children:P({en:"If everyone passes, the last player to play starts a new round with any combination.",vi:"Nếu tất cả bỏ lượt, người đánh cuối cùng sẽ được đi tiếp với bất kỳ bộ nào."})}),t.jsx("li",{children:P({en:"Special: Four of a Kind cuts a 2. Three consecutive pairs cuts a single 2 or three consecutive pairs.",vi:"Đặc biệt: Tứ quý chặt 2. 3 đôi thông chặt 2 hoặc 3 đôi thông nhỏ hơn."})})]})]})})]})}):null,t.jsxs("div",{className:"flex md:hidden justify-center gap-2",children:[J(1,!0),J(2,!0),J(3,!0)]}),t.jsx("div",{className:"hidden md:flex justify-center",children:J(2)}),t.jsxs("div",{className:"hidden md:flex flex-1 items-center justify-between gap-4",children:[J(1),t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4 min-h-[200px] bg-slate-800/30 rounded-2xl p-4",children:["waiting"===u.gamePhase&&t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("span",{className:"text-slate-400",children:"Waiting for players..."}),T&&R&&t.jsxs("button",{onClick:()=>h.requestStartGame(),className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2",children:[t.jsx(n,{className:"w-5 h-5"}),"Start Game"]}),T&&!R&&t.jsx("span",{className:"text-sm text-slate-500",children:"Need at least 2 players to start"})]}),("playing"===u.gamePhase||"ended"===u.gamePhase)&&t.jsx(t.Fragment,{children:H("desktop")}),"ended"===u.gamePhase&&D("desktop")]}),J(3)]}),t.jsxs("div",{className:"flex md:hidden flex-1 flex-col items-center justify-center gap-2 bg-slate-800/30 rounded-xl p-2 min-h-[120px]",children:["waiting"===u.gamePhase&&t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("span",{className:"text-slate-400 text-sm",children:"Waiting for players..."}),T&&R&&t.jsxs("button",{onClick:()=>h.requestStartGame(),className:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg font-medium flex items-center gap-2 text-sm",children:[t.jsx(n,{className:"w-4 h-4"}),"Start"]}),T&&!R&&t.jsx("span",{className:"text-xs text-slate-500",children:"Need 2+ players"})]}),"playing"===u.gamePhase&&t.jsx(t.Fragment,{children:H("mobile")}),"ended"===u.gamePhase&&D("mobile")]}),t.jsxs("div",{className:"flex flex-col items-center gap-2 md:gap-4",children:[t.jsx("div",{className:"hidden md:block",children:J(0)}),t.jsx("div",{className:"flex md:hidden",children:J(0,!0)}),G&&"playing"===u.gamePhase&&t.jsx("div",{className:"flex justify-center max-w-full overflow-x-auto overflow-y-visible pt-4 p-0 md:p-4 pb-1",children:G.hand.map((e,s)=>t.jsx(j,{card:e,selected:g.includes(s),onClick:()=>(e=>{I&&"playing"===u.gamePhase&&f(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(s),disabled:!I,index:s},`${e.rank}-${e.suit}`))}),"playing"===u.gamePhase&&I&&t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[q?.valid&&t.jsx("span",{className:"text-green-400 text-xs md:text-sm font-medium",children:"✓ Valid play"}),!1===q?.valid&&t.jsxs("span",{className:"text-red-400 text-xs md:text-sm font-medium",children:["⚠️ ",q.error]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>{if(0===g.length||!G)return;const e=g.map(e=>G.hand[e]);h.requestPlayCards(e),f([])},disabled:0===g.length||!q?.valid,className:"px-4 py-1.5 md:px-6 md:py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-900 disabled:cursor-not-allowed rounded-lg font-medium flex items-center gap-1 md:gap-2 text-sm",children:[t.jsx(n,{className:"w-4 h-4"}),"Play"]}),u.lastCombination&&t.jsxs("button",{onClick:async()=>{await a.getState().confirm("You will not be able to play cards until the next round.","Pass this round?")&&h.requestPass()},className:"px-4 py-1.5 md:px-6 md:py-2 bg-red-700 hover:bg-red-600 rounded-lg font-medium flex items-center gap-1 md:gap-2 text-sm",children:[t.jsx(i,{className:"w-4 h-4"}),"Pass"]})]})]}),"waiting"!==u.gamePhase&&t.jsx("div",{className:"flex gap-2",children:t.jsxs("button",{onClick:async()=>{if(T&&"playing"===u.gamePhase){await a.getState().confirm("This will reset the current game and start fresh.","Start New Game?")&&h.requestNewGame()}else h.requestNewGame()},className:"px-3 py-1.5 md:px-4 md:py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs md:text-sm flex items-center gap-1 md:gap-2",children:[t.jsx(r,{className:"w-3 h-3 md:w-4 md:h-4"}),"New game"]})})]}),T&&u.newGameRequest&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 md:p-6 max-w-sm w-full shadow-xl",children:[t.jsx("h3",{className:"text-base md:text-lg font-bold mb-3 md:mb-4",children:"New Game Request"}),t.jsxs("p",{className:"text-slate-300 mb-4 md:mb-6 text-sm md:text-base",children:[t.jsx("span",{className:"font-medium text-white",children:u.newGameRequest.fromName})," ","wants to start a new game."]}),t.jsxs("div",{className:"flex gap-2 md:gap-3",children:[t.jsxs("button",{onClick:()=>h.declineNewGame(),className:"flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[t.jsx(d,{className:"w-4 h-4"}),"Decline"]}),t.jsxs("button",{onClick:()=>h.acceptNewGame(),className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg font-medium flex items-center justify-center gap-2 text-sm",children:[t.jsx(c,{className:"w-4 h-4"}),"Accept"]})]})]})}),t.jsx("button",{onClick:()=>k(!0),className:"fixed bottom-4 right-4 p-3 bg-slate-700 hover:bg-slate-600 rounded-full text-yellow-500 transition-colors z-40 shadow-lg border border-slate-500",title:S({en:"Rules",vi:"Luật chơi"}),children:t.jsx(m,{size:24})})]})}function j({card:e,selected:s,onClick:a,disabled:l=!1,index:n=0}){const i=e.suit===p.HEART||e.suit===p.DIAMOND?"text-red-500":"text-slate-800",r=0===n?"ml-0":"-ml-5 md:-ml-9";return t.jsx("button",{onClick:a,disabled:l,style:{zIndex:n},className:`\n        ${r}\n        w-10 h-16 md:w-16 md:h-20\n        bg-white rounded-md md:rounded-lg shadow-lg\n        border-2 transition-all duration-150 font-bold shrink-0 relative\n        ${s?"border-primary-500 -translate-y-3 ring-2 ring-primary-400 shadow-primary-500/30 shadow-xl z-50":"border-slate-300 hover:border-slate-400"}\n        ${!l&&a?(s?"":"md:hover:-translate-y-1")+" cursor-pointer":"cursor-default"}\n      `,children:t.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${i}`,children:[t.jsx("span",{className:"text-sm md:text-lg font-bold",children:g[e.rank]}),t.jsx("span",{className:"text-sm md:text-sm",children:f[e.suit]})]})})}function N({card:e,delay:s=0,index:a=0}){const l=e.suit===p.HEART||e.suit===p.DIAMOND?"text-red-500":"text-slate-800",n=0===a?"ml-0":"-ml-6 md:-ml-9";return t.jsx("div",{style:{animationDelay:`${s}ms`},className:`\n        ${n}\n        w-10 h-14 md:w-16 md:h-20\n        bg-white rounded-md md:rounded-lg shadow-lg\n        border-2 border-slate-200 font-bold shrink-0 relative\n        animate-[cardPlay_0.3s_ease-out_forwards]\n      `,children:t.jsxs("div",{className:`absolute top-0.5 left-1 flex flex-col items-center leading-none ${l}`,children:[t.jsx("span",{className:"text-xs md:text-lg font-bold",children:g[e.rank]}),t.jsx("span",{className:"text-[10px] md:text-sm",children:f[e.suit]})]})})}function v({slot:e,index:s,isCurrentTurn:a,isHost:l,gamePhase:n,onAddBot:i,onJoinSlot:r,onRemove:c,compact:m=!1,isInGame:o}){const p=null===e.id,g=l&&"waiting"===n,f=!l&&"waiting"===n&&!o;return t.jsx("div",{className:`\n        ${m?"p-2 min-w-[90px]":"p-2 md:p-3 min-w-[100px] md:min-w-[120px]"}\n        rounded-lg md:rounded-xl transition-all border-2\n        ${e.passed&&"playing"===n?"border-slate-600 bg-slate-900/70 opacity-50":a&&"playing"===n?"border-primary-600 bg-primary-500/10 animate-bounce":"border-slate-700 bg-slate-800/50"}\n        ${p?"border-dashed":""}\n      `,children:p?t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("span",{className:"text-slate-500 text-xs text-center",children:["Slot ",s+1]}),t.jsxs("div",{className:"flex gap-1",children:[g&&t.jsx("button",{onClick:i,className:"flex-1 p-1 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center",title:"Add Bot",children:t.jsx(x,{className:"w-5 h-5"})}),f&&t.jsxs("button",{onClick:r,className:"flex-1 p-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs flex items-center justify-center gap-1",title:"Join this slot",children:[t.jsx(h,{className:"w-4 h-4"}),"Join"]})]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[e.isBot&&t.jsx(x,{className:"w-5 h-5 text-blue-400"}),e.isGuest&&t.jsx(h,{className:"w-5 h-5 text-green-400"}),e.isHost&&t.jsx(u,{className:"w-5 h-5 text-yellow-400"}),t.jsx("span",{className:"text-xs font-medium",children:e.username}),g&&(e.isBot||e.isGuest)&&t.jsx("button",{onClick:c,className:"p-0.5 hover:bg-slate-700 rounded",title:"Remove",children:t.jsx(d,{className:"w-5 h-5 text-red-400"})})]}),"playing"===n||"ended"===n&&t.jsxs("span",{className:"text-[10px] text-slate-400",children:[e.hand.length," cards"]}),e.passed&&t.jsx("span",{className:"text-[10px] text-yellow-400",children:"Passed"})]})})}export{b as default};
